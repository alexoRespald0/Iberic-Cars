<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Anuncio de Coche</title>
  <link rel="stylesheet" href="anuncio.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>

  <header>
    <div class="logo">
      <a href="index.html">
        <img src="Imagenes/IBERIC (2).png" alt="Logo de la empresa" />
      </a>
    </div>
    <h1 class="titulo-header">Iberic Cars</h1>
    <nav>
      <ul>
        <li><a href="index.html">Inicio</a></li>
        <li><a href="buscar.html">Buscar</a></li>
        <li><a href="Contacto/contacto.html">Contacto</a></li>
        <li id="nav-favoritos" style="display: none;"><a href="favorito.html">Favoritos</a></li>
        <li><a id="btn-sesion" href="login.html"><button class="login">Acceder</button></a></li>
        <li><button class="buy">Comprar</button></li>
      </ul>
    </nav>
  </header>

  <div class="anuncio-coche">

  <!-- Galería -->
  <div class="galeria-coche">
  <div class="galeria-contenedor">
    <button class="flecha izquierda" onclick="cambiarImagen(-1)">&#10094;</button>

    <img id="imagen-principal" class="galeria-principal" src="" alt="Vista principal del coche" />

    <button class="flecha derecha" onclick="cambiarImagen(1)">&#10095;</button>
    </div>

    <div class="miniaturas">
      <img src="" alt="Vista 1" onclick="cambiarImagenPrincipal(this.src)" />
      <img src="" alt="Vista 2" onclick="cambiarImagenPrincipal(this.src)" />
      <img src="" alt="Vista 3" onclick="cambiarImagenPrincipal(this.src)" />
      <img src="" alt="Vista 4" onclick="cambiarImagenPrincipal(this.src)" />
      <img src="" alt="Vista 5" onclick="cambiarImagenPrincipal(this.src)" />
    </div>
  </div>

  <!-- Detalles -->
  <div class="detalles-coche">
    <h1>Nombre del Coche</h1>
    <div class="detalles-grid">
      <div class="detalles-item"><strong>Marca:</strong></div>
      <div class="detalles-item"><strong>Modelo:</strong></div>
      <div class="detalles-item"><strong>Año:</strong></div>
      <div class="detalles-item"><strong>Kilómetros:</strong></div>
      <div class="detalles-item"><strong>Combustible:</strong></div>
      <div class="detalles-item"><strong>Precio:</strong></div>
      <div class="detalles-item"><strong>Transmisión:</strong></div>
    </div>
  </div>

  <!-- Botón CTA -->
  <div class="cta">
    <button onclick="alert('Formulario de contacto no implementado')">
      Añadir al carrito
    </button>
  </div>

</div>


  <footer>
    <div class="columnas">
      <!-- Columna 1: Logo y nombre -->
      <div class="columna logo-columna">
        <img src="Imagenes/IBERIC (2).png" alt="Logo Iberic Cars" class="footer-logo" />
        <h3>Iberic Cars</h3>
      </div>

      <!-- Columna 2: Nosotros -->
      <div class="columna">
        <h3>Nosotros</h3>
        <p>
          Somos un concesionario especializado en la venta de coches de todo tipo: deportivos, familiares, eléctricos y más. Trabajamos con marcas reconocidas como Audi, BMW, Toyota y Volkswagen.
        </p>
      </div>

      <!-- Columna 3: Contacto -->
      <div class="columna">
        <h3>Contacto</h3>
        <p>📞 Teléfono: +34 600 123 456</p>
        <p>📷 Instagram: <a href="#">@ibericcars</a></p>
        <p>📘 Facebook: <a href="#">Iberic Cars Oficial</a></p>
      </div>
    </div>
    <!-- Línea inferior de derechos -->
    <div class="footer-bottom">© 2025 Iberic Cars. Todos los derechos reservados.</div>
  </footer>
  <script>
  const supabaseUrl = 'https://yhcivepnywbvskalfqfd.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InloY2l2ZXBueXdidnNrYWxmcWZkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcwODA5ODgsImV4cCI6MjA2MjY1Njk4OH0.Nl2_D3j5MHTuGnIaelVrREqLqQSPE-Z8ciVnaJGVa-w';
  const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

  let imagenes = [];
  let indiceActual = 0;

  function actualizarImagen() {
    const principal = document.getElementById('imagen-principal');
    principal.src = imagenes[indiceActual] || 'Imagenes/default-car.png';

    const miniaturas = document.querySelectorAll('.miniaturas img');
    miniaturas.forEach((img, index) => {
      img.src = imagenes[index] || 'Imagenes/default-car.png';
      img.classList.toggle('seleccionada', index === indiceActual);
      img.onclick = () => seleccionarImagen(index);
    });
  }

  function cambiarImagen(direccion) {
    if (imagenes.length === 0) return;
    indiceActual = (indiceActual + direccion + imagenes.length) % imagenes.length;
    actualizarImagen();
  }

  function seleccionarImagen(indice) {
    indiceActual = indice;
    actualizarImagen();
  }

  async function cargarCochePorID(id) {
    const { data, error } = await supabase
      .from('coches')
      .select('*')
      .eq('id_coche', id)
      .single();

    if (error) {
      console.error('Error al cargar datos del coche:', error);
      return;
    }

    // Cargar imágenes
    imagenes = [
      data.imagenprincipal,
      data.foto1,
      data.foto2,
      data.foto3,
      data.foto4
    ].filter(Boolean);

    indiceActual = 0;
    actualizarImagen();

    // Título
    document.querySelector('.detalles-coche h1').textContent = `${data.marca} ${data.modelo}`;

    // Detalles
    const detalles = document.querySelectorAll('.detalles-item');
    detalles[0].innerHTML = `<strong>Año</strong> ${data.año}`;
    detalles[1].innerHTML = `<strong>Combustible</strong> ${data.combustible}`;
    detalles[2].innerHTML = `<strong>Transmisión</strong> ${data.transmision}`;
    detalles[3].innerHTML = `<strong>Puertas</strong> ${data.puertas}`;
    detalles[4].innerHTML = `<strong>Carrocería</strong> ${data.carroceria}`;
    detalles[5].innerHTML = `<strong>Color</strong> ${data.color}`;
    detalles[6].innerHTML = `<strong>Precio</strong> ${data.precio} €`;
  }

  // Inicialización al cargar la página
  window.addEventListener('DOMContentLoaded', async () => {
    // Control de sesión
    const btnSesion = document.getElementById('btn-sesion');
    const loginButton = btnSesion?.querySelector('button');

    const { data: userData, error: userError } = await supabase.auth.getUser();

    if (userData?.user) {
      // Usuario logueado
      if (loginButton) loginButton.textContent = 'Cerrar sesión';
      btnSesion?.removeAttribute('href');
      btnSesion?.addEventListener('click', async () => {
        await supabase.auth.signOut();
        window.location.reload();
      });

      const navFavoritos = document.getElementById('nav-favoritos');
      if (navFavoritos) {
        navFavoritos.style.display = 'inline-block';
      }

    } else {
      // No hay sesión
      if (loginButton) loginButton.textContent = 'Acceder';
      btnSesion?.setAttribute('href', 'login.html');
    }

    // Cargar coche por ID
    const params = new URLSearchParams(window.location.search);
    const idCoche = params.get('id');
    if (idCoche) {
      await cargarCochePorID(idCoche);
    } else {
      console.warn('No se proporcionó un ID de coche en la URL.');
    }
  });
</script>



</body>
</html>
